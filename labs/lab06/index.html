<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="language" content="english">
<title>Lab 6 | CS 61C Spring 2022</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">
<link rel="shortcut icon" type="image/png" href="../../img/favicon.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" integrity="sha512-GQGU0fMMi238uA+a/bdWJfpUGKUkBdgfFdgBm72SUQ6BeyWjoY/ton0tEjH+OSH9iP4Dfh+7HM0I9f5eR0L/4w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.min.js" integrity="sha512-OvBgP9A2JBgiRad/mM36mkzXSXaJE9BEIENnVEmeZdITvwT09xnxLtT4twkCa8m/loMbPHsvPl0T8lRGVBwjlQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>
<link rel="stylesheet" href="../../css/main.css@h=36c89645dcb547d13f6f293a379a176dff22aab9affcefc8d3a19bc23c0f8db2.css" />
<script defer type="text/javascript" src="../../js/main.js@h=4096b5e2a18784c27ca139ca897694176eea13de3e2168cd7e7bcdd827a35c8d"></script>

<script type="text/javascript" src="../../js/main-sync.js@h=daca62fef99fb16ad6a5fd1517d7b18bed66d3241431785bf3ac1f134c166bf1"></script>
<script>initDarkToggle();</script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.17.0/tocbot.min.js" integrity="sha512-DJhUMo5TIBb3fFziiE+3OJG+j7ky+GxScxHdLADCXskEpc/AKQsbsorIYmGFJFaJvDIyP65rJNhnCTytfYAdUw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark mb-4">
<div class="container">
<a class="navbar-brand" href="../../index.html">
<img class="d-inline-block me-2 rounded" height="48" width="48" src="../../img/icon-small.png" alt="outline of square computer chip with cs61c label" />
<span class="align-middle">CS 61C Spring 2022</span>
</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle Navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarContent">
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
<a class="nav-link" href="../../calendar/index.html">Calendar</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../../staff/index.html">Staff</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../../policies/index.html">Policies</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../../resources/index.html">Resources</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../../exam/index.html">Exam</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../../extensions/index.html">Extensions</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://oh.cs61c.org/">OH Queue</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://venus.cs61c.org/">Venus</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/archives.html">Semesters</a>
</li>
</ul>
</div>
</div>
</nav>
<main class="mb-4">
<section class="section">
<div class="container">
<div class="row spec">
<nav id="toc-wrapper" class="col-md-3 d-print-none sticky-md-top nav-wrapper" aria-label="table of contents">
<ul class="nav flex-column">
<li class="nav-item">
<a class="nav-link" href="index.html#setup">Setup</a>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#exercise-1-constructing-immediates">Exercise 1 - Constructing Immediates</a>
<ul class="nav flex-column">
<li class="nav-item">
<a class="nav-link" href="index.html#action-item">Action Item</a>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#testing">Testing</a>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#exercise-2-constructing-the-brun-control-signal">Exercise 2 - Constructing the BrUn Control Signal</a>
<ul class="nav flex-column">
<li class="nav-item">
<a class="nav-link" href="index.html#action-item-1">Action Item</a>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#testing-1">Testing</a>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#exercise-3-inefficiencies-everywhere">Exercise 3 - Inefficiencies Everywhere</a>
<ul class="nav flex-column">
<li class="nav-item">
<a class="nav-link" href="index.html#action-item-2">Action Item</a>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#exercise-4-pipe-that-line">Exercise 4 - Pipe that Line</a>
<ul class="nav flex-column">
<li class="nav-item">
<a class="nav-link" href="index.html#action-item-3">Action Item</a>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#testing-2">Testing</a>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#exercise-5-lab-6-feedback">Exercise 5 - Lab 6 Feedback</a>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#exercise-6-mid-semester-survey">Exercise 6 - Mid Semester Survey</a>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html#submission">Submission</a>
</li>
</ul>
</nav>
<div id="toc-content-wrapper" class="content col-md-9">
<h1 class="title">Lab 6: CPU, Pipelining</h1>
<p class="subtitle">Deadline: Monday, March 14, 11:59:59 PM PT</p>
<hr />
<p><a href="https://docs.google.com/presentation/d/1TMf0mWJhZe9o6o_VpyWON2AfSBRD7zsp2FCe_QUGMes/edit?usp=sharing">Lab Section Slides</a></p>
<hr />
<h2 id="setup">Setup</h2>
<p>In your <code>labs</code> directory, pull the files for this lab with:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">git</span></span><span class="z-meta z-function-call z-arguments z-shell"> pull starter main</span>
</span></code></pre>
<p>Like Lab 5, all the work in this lab will be done using the digital logic simulation program <strong>Logisim Evolution</strong>.</p>
<p>Some important warnings before you begin:</p>
<ul>
<li>Logisim is a GUI program, so it can't easily be used in a headless environment (WSL, SSH, etc.). We recommend running it in a <strong>local environment</strong> with a GUI, Java 9+, and Python 3.6+. If your local system is macOS or Linux you're probably all set. If you're on Windows, use <code>Git Bash</code>, which runs on Windows with GUI support.</li>
<li>Please use the version of Logisim that we distribute, since it is different from other versions on the internet (bugfixes and course-specific stuff)</li>
<li>Don't move the staff-provided input/output pins; your circuit can't be tested properly if the pins move. If your circuit doesn't pass the tests and you think it is correct, check that your circuit fits in the corresponding harness in <code>tests/ex#-test.circ</code></li>
<li>Logisim doesn't auto-save your work. Remember to save (and commit) frequently as you work!</li>
</ul>
<h2 id="exercise-1-constructing-immediates">Exercise 1 - Constructing Immediates</h2>
<p>As we have seen in lecture, there are five types of immediates in RISC-V: I-type, S-type, B-type, U-type, and J-type. In this exercise, you will be implementing the <strong>S-type</strong> immediate generator. <code>ex1.circ</code> will take as an input a 32-bit RISC-V store instruction. It should output the sign-extended 32-bit immedate value of the instruction. Constructing the immediate value will require the use of splitters. You can find the summary of how splitters work under the Advanced Logisim Features section in Lab 5.</p>
<h3 id="action-item">Action Item</h3>
<p><code>ex1.circ</code> will take in a 32-bit RISC-V <strong>store instruction</strong>. Your job is to modify the circuit so that it outputs the 32-bit sign-extended immediate value of the instruction. You may assume that the instruction is always a store instruction.</p>
<h3 id="testing">Testing</h3>
<p>Open a local terminal session and go to the <code>lab06</code> folder. We've provided tests for Exercise 1, which you can run with <code>python3 test.py</code>. Your Exercise 1 circuit is run in a test harness circuit (<code>tests/ex1-test.circ</code>), and its output is compared against the reference output for that test (<code>tests/reference-output/ex1-test.out</code>). In the output file, each column corresponds to an input/output pin on the main circuit, and each row shows a set of inputs and the corresponding outputs the circuit produced. If your circuit output (<code>tests/student-output/ex1-test.out</code>) is different, you can check it against the reference output file; the <code>diff</code> command may help. <strong>New: The output files are now in csv format to make it easier for you to read.</strong></p>
<hr />
<h2 id="exercise-2-constructing-the-brun-control-signal">Exercise 2 - Constructing the BrUn Control Signal</h2>
<p>The <code>BrUn</code> control signal is used to tell the branch comparator whether the branch comparison is being performed on signed or unsigned numbers. <code>BrUn</code> is set to <code>1</code> if the comparison is being performed on unsigned numbers, and it is set to <code>0</code> if the comparison is being performed on signed numbers. If the branch is <code>beq</code> or <code>bne</code>, or the the instruction is not a branch instruction, we don't care about the value of <code>BrUn</code>, so you can set it to either <code>0</code> or <code>1</code> (make sure you understand why).</p>
<p>We've provided you with the answers to the following questions to help you with your implementation.</p>
<details>
<summary>Which field of the instruction identifies the type of branch?</summary>
funct3
</details>
<details>
<summary>Does the opcode field matter?</summary>
No. The opcode field does not matter in this case since the BrUn signal is 'don't care' for all non-branch instructions. We can simply output a 1 if the funct3 field corresponds to the funct3 field of the unsigned branch instructions.
</details>
<p>Constants and comparators will be very helpful for this exercise. The constants can be found in the 'Wiring' library. You can choose the value of the constant in the 'Properties' section in the bottom left window. You can also change the number of bits that are used to represent the constant in the 'Properties' section.</p>
<p>Comparators have two inputs and are used to determine if the first input is less than, equal to, or greater than the second input. They can be found in the 'Arithmetic' library. You can select the size of the inputs and whether the comparison is unsigned or 2's complement in the 'Properties' section in the bottom left window.</p>
<h3 id="action-item-1">Action Item</h3>
<p><code>ex2.circ</code> takes as an input a 32-bit RISC-V instruction and outputs the value of the <code>BrUn</code> control signal. Your job is to modify the circuit so that it properly generates the value of <code>BrUn</code>. The input instruction may or may not be a branch instruction. </p>
<h3 id="testing-1">Testing</h3>
<p>Open a local terminal session and go to the <code>lab06</code> folder. We've provided tests for Exercise 2, which you can run with <code>python3 test.py</code>. Your Exercise 2 circuit is run in a test harness circuit (<code>tests/ex2-test.circ</code>), and its output is compared against the reference output for that test (<code>tests/reference-output/ex2-test.out</code>). In the output file, each column corresponds to an input/output pin on the main circuit, and each row shows a set of inputs and the corresponding outputs the circuit produced. If your circuit output (<code>tests/student-output/ex2-test.out</code>) is different, you can check it against the reference output file; the <code>diff</code> command may help. <strong>New: The output files are now in csv format to make it easier for you to read.</strong></p>
<hr />
<h2 id="exercise-3-inefficiencies-everywhere">Exercise 3 - Inefficiencies Everywhere</h2>
<p>For this exercise, we can assume that registers initially carry the value zero. We will be using the lab file <code>ex3.circ</code>, which should have a subcircuit called <code>non_pipelined</code> which looks something like this:</p>
<p><img src="exercise3.png" alt="" /></p>
<p>This circuit simply takes two inputs, multiplies them together, and then adds the result to the current state value. For this circuit, let the propagation delay of an adder block be 45ns and the propagation delay of a multiplication block be 60ns. The register has a CLK-to-Q delay of 10ns, setup time of 10ns, and hold time of 5ns. Assume that both inputs receive their data from registers (so the inputs arrive CLK-to-Q after the rising edge).</p>
<h3 id="action-item-2">Action Item</h3>
<ol>
<li>Calculate the length of the critical path of this circuit in <strong>ns</strong>. Put this number in <strong>ex3.txt</strong> without units.</li>
</ol>
<hr />
<h2 id="exercise-4-pipe-that-line">Exercise 4 - Pipe that Line</h2>
<p>We want to improve the performance of this circuit and let it operate at a higher clock rate. In order to accomplish this, we want to have two stages in our pipeline: a multiplication stage and an addition stage, in that order.</p>
<p>To pipeline the circuit, we need a register to hold the intermediate value of the computation between pipeline stages. This is a general theme with pipelining.</p>
<p>In order to check that your pipelining still produces correct outputs, we will consider the outputs from the circuit &quot;correct&quot; if and only if it corresponds to the sequence of outputs the non-pipelined version would emit, but now the circuit will have a leading zero. This leading zero occurs because the second stange of the pipeline is &quot;empty&quot; in the first cycle. </p>
<p>To view the inputs to the circuit and the corresponding outputs for each cycle, take a look at <code>reference-output/ex4-test.out</code>. The output is <code>00000000</code> for cyle zero because nothing has moved through the pipeline yet. Cycle zero is essentially just printing out the starting state of the circuit. The output is <code>00000000</code> for cycle one because the second stage of the pipeline is &quot;empty&quot; in the first cycle.</p>
<p>We discussed that if an instruction depends on the output of a previous instruction, we need to either insert a pipeline &quot;bubble&quot; (or several) or include forwarding logic to ensure that the output of the first instruction is ready to be an input to the second. As a reminder, a bubble purposely delays an instruction in the pipeline.
<details>
<summary>Why are such &quot;bubbles&quot; unnecessary for this particular circuit?</summary>
<p>For this exercise, ONE instruction consists of BOTH an addition and a multiplication. The addition and multiplication are NOT two separate instructions.</p>
<p>Instead, they are two separate stages in the pipeline, similar to how EX and MEM are two separate stages in a pipeline that operate on the same instruction with EX operating on the instruction before MEM operates on the instruction second.</p>
<p>We do not have any bubbles in this particular circuit because none of the individual instructions depend on each other.</p>
</details></p>
<h3 id="action-item-3">Action Item</h3>
<ol>
<li>In <code>ex4.circ</code>, pipeline the circuit found in <code>ex3.circ</code></li>
<li>Calculate the critical path of this pipelined circuit in <strong>ns</strong>. Put this number on the first line of <strong>ex4.txt</strong> without units.</li>
<li>Calculate the maximum clock rate for this pipelined circuit in <strong>MHz</strong>. Put this number on the second line of <strong>ex4.txt</strong> without units.</li>
</ol>
<h3 id="testing-2">Testing</h3>
<p>Open a local terminal session and go to the <code>lab06</code> folder. We've provided tests for Exercise 4, which you can run with <code>python3 test.py</code>. Your Exercise 4 circuit is run in a test harness circuit (<code>tests/ex4-test.circ</code>), and its output is compared against the reference output for that test (<code>tests/reference-output/ex4-test.out</code>). In the output file, each column corresponds to an input/output pin on the main circuit, and each row shows a set of inputs and the corresponding outputs the circuit produced. If your circuit output (<code>tests/student-output/ex4-test.out</code>) is different, you can check it against the reference output file; the <code>diff</code> command may help. <strong>New: The output files are now in csv format to make it easier for you to read.</strong></p>
<hr />
<h2 id="exercise-5-lab-6-feedback">Exercise 5 - Lab 6 Feedback</h2>
<p>We are working to improve the labs for next semester, so please fill out <a href="https://docs.google.com/forms/d/e/1FAIpQLSdN0VwUn6Vx07VJm3QGQxo8fxF3spFyVk9Jm3D63as-H1QCDg/viewform?usp=sf_link">this survey</a> to tell us about your experience with Lab 6. The survey will be collecting your email to verify that you have submitted it, but your responses will be anonymized before the data is analyzed. Thank you!</p>
<hr />
<h2 id="exercise-6-mid-semester-survey">Exercise 6 - Mid Semester Survey</h2>
<p>Congratulations on making it halfway through 61C! We request that you provide feedback on how the course is being run so we can better meet your learning needs for the remainder of the course. <a href="https://docs.google.com/forms/d/e/1FAIpQLSequcC0XTHZRCM9hm-9l3OK7llEyDxAgFVIagH09Ela6VLEMw/viewform?usp=sf_link">This feedback survey</a> is only collecting emails to verify that you have completed it. When the results are analyzed, the data will be anonymized. The content of your responses will not affect your grade.</p>
<hr />
<h2 id="submission">Submission</h2>
<p>Save, commit, and push your work, then submit to the <strong>Lab 6</strong> assignment on Gradescope.</p>
</div>
</div>
</div>
</section>
</main>
<footer>
<div class="container border-top pt-4 mb-5">
<div class="row">
<div class="col">
<div id="dark-toggle-wrapper" class="d-none">
<div class="form-check form-switch">
<input id="inputDarkToggle" class="form-check-input" type="checkbox">
<label class="form-check-label" for="inputDarkToggle">
Dark Mode
<a id="buttonDarkToggleReset" class="d-none" href="javascript:void(0);">(reset)</a>
</label>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
  

  
    document.addEventListener("DOMContentLoaded", function() {
      initToC();
    });
  
</script>
</body>
</html>
